---
import { getGithubArticle, parseMarkdown } from "../services/github.js";

const { slug } = Astro.props;

console.log("2. Slug re√ßu en props:", slug);

let article;
let htmlContent = "";

if (slug) {
  console.log("3. Tentative r√©cup√©ration GitHub:", slug);
  try {
    const rawContent = await getGithubArticle(slug);
    const { frontmatter, content } = parseMarkdown(rawContent);

    article = { data: frontmatter };
    htmlContent = content;

    console.log("4. Article trouv√©! Titre:", article.data.title);
  } catch (error) {
    console.log("4. ERREUR GitHub:", error.message);
  }
} else {
  console.log("3. Pas de slug!");
}
---

<div class="py-20 bg-gray-800 text-white">
  <div class="max-w-4xl mx-auto px-4">
    {
      slug && article ? (
        <div>
          <a href="/ArticlesPage" class="text-blue-400 mb-4 inline-block">
            ‚Üê Retour √† la liste
          </a>

          <h1 class="text-4xl font-bold mb-4">{article.data.title}</h1>

          {article.data.author && (
            <p class="text-gray-300 mb-2">‚úçÔ∏è Par : {article.data.author}</p>
          )}

          {article.data.date && (
            <p class="text-gray-300 mb-4">üìÖ Date : {article.data.date}</p>
          )}

          <main class="prose  max-w-none mt-8">
            <div set:html={htmlContent} />
          </main>
        </div>
      ) : (
        <div class="text-center">
          <h1 class="text-2xl mb-4">Aucun article s√©lectionn√©</h1>
          <a href="/ArticlesPage" class="text-blue-400">
            ‚Üê Voir la liste des articles
          </a>
        </div>
      )
    }
  </div>
</div>
